version: 0.2

phases:
  install:
    runtime-versions:
      java: corretto17

  pre_build:
    commands:
      - echo Build started on `date`
      - java -version
      - echo Downloading and installing Gradle...
      - wget -q https://services.gradle.org/distributions/gradle-8.5-bin.zip
      - unzip -q gradle-8.5-bin.zip
      - export PATH=$PWD/gradle-8.5/bin:$PATH
      - gradle --version

  build:
    commands:
      - echo Building with Gradle...
      - gradle clean build -x test

  post_build:
    commands:
      - echo Build completed on `date`
      # 1. ì•„í‹°íŒ©íŠ¸ë¥¼ ëª¨ì„ ì„ì‹œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      - DEPLOY_DIR=deploy_artifact
      - mkdir -p $DEPLOY_DIR

      # 2. JAR íŒŒì¼(ë¹Œë“œ ê²°ê³¼ë¬¼)ì„ ì„ì‹œ ë””ë ‰í† ë¦¬ë¡œ ì´ë™/ë³µì‚¬í•©ë‹ˆë‹¤.
      - cp build/libs/*.jar $DEPLOY_DIR/  # â˜… JAR íŒŒì¼ ë³µì‚¬

      # 3. appspec.ymlê³¼ ìŠ¤í¬ë¦½íŠ¸ë“¤ì„ ë³µì‚¬í•©ë‹ˆë‹¤.
      - cp appspec.yml $DEPLOY_DIR/
      - cp -r scripts/ $DEPLOY_DIR/

      # 4. ì„ì‹œ ë””ë ‰í† ë¦¬ì˜ ë‚´ìš©ì„ í™•ì¸í•©ë‹ˆë‹¤.
      - ls -la $DEPLOY_DIR

      - echo Creating final deployment zip manually...
      - cd $DEPLOY_DIR
      # deployment-artifact.zip íŒŒì¼ì„ 'deploy_artifact' í´ë”ì˜ ë‚´ìš©ë¬¼ë¡œ ìƒì„±
      - zip -r -q ../deployment-artifact.zip .
      - cd ..
#      - echo Build completed on `date`


artifacts:
  files:
    # ğŸš¨ ì´ ZIP íŒŒì¼ í•˜ë‚˜ë§Œ S3ì— ì˜¬ë¦¬ë„ë¡ ì§€ì •í•©ë‹ˆë‹¤.
    - 'deployment-artifact.zip'
  discard-paths: no # base-directoryë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì„¤ì • ì œê±°